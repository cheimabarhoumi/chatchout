<!DOCTYPE html>
<html>
<head>
    <title>Test Socket.IO Connection</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.IO Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="logs"></div>
    
    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
            console.log(message);
        }
        
        // Get token from localStorage (if available)
        const token = localStorage.getItem('token');
        log('Token available: ' + (token ? 'YES' : 'NO'));
        
        if (!token) {
            document.getElementById('status').innerHTML = 'No token found. Please login first.';
            log('Please login to the main app first to get a token');
        } else {
            log('Token: ' + token.substring(0, 20) + '...');
            
            // Test Socket.IO connection
            const socket = io('http://localhost:5000', {
                auth: {
                    token: token
                },
                transports: ['websocket', 'polling']
            });
            
            socket.on('connect', () => {
                log('✅ Connected to Socket.IO server!');
                document.getElementById('status').innerHTML = '✅ Connected';
                document.getElementById('status').style.color = 'green';
            });
            
            socket.on('disconnect', () => {
                log('❌ Disconnected from Socket.IO server');
                document.getElementById('status').innerHTML = '❌ Disconnected';
                document.getElementById('status').style.color = 'red';
            });
            
            socket.on('connect_error', (error) => {
                log('❌ Connection error: ' + error.message);
                document.getElementById('status').innerHTML = '❌ Connection Error: ' + error.message;
                document.getElementById('status').style.color = 'red';
            });
            
            socket.on('error', (error) => {
                log('❌ Socket error: ' + error);
                document.getElementById('status').innerHTML = '❌ Socket Error: ' + error;
                document.getElementById('status').style.color = 'red';
            });
            
            // Test sending a message after 2 seconds
            setTimeout(() => {
                if (socket.connected) {
                    log('📤 Testing message send...');
                    socket.emit('test_message', { message: 'Hello from test page!' });
                }
            }, 2000);
        }
    </script>
</body>
</html>
